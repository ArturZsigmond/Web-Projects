<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Guest Book</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; }
        input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; }
        .entry { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        .pagination { display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<h2>Add Entry</h2>
<form id="entryForm">
    <input type="email" name="author" placeholder="Your Email" required>
    <input type="text" name="title" placeholder="Title" required>
    <textarea name="comment" placeholder="Your Comment" required></textarea>
    <button type="submit">Add Entry</button>
</form>

<h2>Guest Book Entries</h2>
<div id="entries"></div>

<div class="pagination">
    <button onclick="loadEntries(currentPage - 1)">Prev</button>
    <button onclick="loadEntries(currentPage + 1)">Next</button>
</div>

<script>
let currentPage = 1;

document.getElementById('entryForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch('add_entry.php', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Entry added!");
            this.reset();
            loadEntries(1); 
        } else {
            alert("Error: " + (data.error || "Could not add entry"));
        }
    });
});

function loadEntries(page) {
    if (page < 1) return;
    fetch('fetch_entries.php?page=' + page)
        .then(res => res.json())
        .then(entries => {
            if (entries.length === 0 && page > 1) return; 
            currentPage = page;
            const container = document.getElementById('entries');
            container.innerHTML = '';
            entries.forEach(entry => {
                container.innerHTML += `
                    <div class="entry">
                        <strong>${entry.author}</strong> | <em>${entry.title}</em><br>
                        <small>${entry.date}</small><br>
                        <p>${entry.comment}</p>
                    </div>
                `;
            });
        });
}

loadEntries(1);
</script>

</body>
</html>

